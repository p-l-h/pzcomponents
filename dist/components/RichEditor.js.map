{"version":3,"sources":["../../src/components/RichEditor.js"],"names":[],"mappings":"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","file":"RichEditor.js","sourcesContent":["\n\nimport { EventBase } from './EventBase';\nimport { weixinApi } from '../common/functions/weixinApi';\nimport { Audio } from './Audio';\nimport { AudioPlayer } from './AudioPlayer';\nimport { Recorder } from './Recorder';\n\nimport {loading, unloading} from './Toast';\n\n\nconst DELETE_IMG_CLASS = 'ion-android-remove-circle';\nconst noop = () => {};\n\nclass Materials extends EventBase {\n    constructor(elem, options) {\n        super(elem);\n        this.options = options;\n    }\n\n    init() {\n        let self = this;\n        let options = this.options;\n\n        if (options.readonly) {\n            this.container.addClass('readonly');\n        }\n\n        if (options.data) {\n            options.data.forEach(\n                (item) => {\n                    self.addItem(item);\n                }\n            );\n        }\n\n        self.bindEvents && self.bindEvents();\n\n        this.container.on('click', '.' + DELETE_IMG_CLASS, function (e) {\n            e.stopPropagation();\n            $(this).closest('li').remove();\n            self.count--;\n        });\n    }\n\n    readonly(readonly=false) {\n\n        if (readonly ) {\n            this.container.addClass('readonly');\n        }\n        else {\n            this.container.removeClass('readonly');\n        }\n        this.options.readonly = readonly;\n    }\n\n    getData(callback=noop) {\n        this.getServerAndLocalIds();\n        this.upload(callback);\n    }\n\n}\n\n\nclass Images extends Materials {\n    constructor(elem, options) {\n        super(elem, options);\n        this.materialType = 'image';\n        this.count = 0;\n        this.init();\n    }\n\n    bindEvents() {\n\n        let self = this;\n\n        this.container.on('click', 'img', function (e) {\n\n            e.stopPropagation();\n\n            let $this = $(this);\n            let currentUrl = $this.prop('src');\n\n            let imgsArr = self.getAllImages();\n\n            if (+$this.data('islocal')) {\n                currentUrl = $this.data('localid');\n            }\n            weixinApi.previewImage(currentUrl, imgsArr);\n        });\n\n\n    }\n\n    getAllImages() {\n        let self = this;\n\n        self.getServerAndLocalIds();\n\n        let imgsArr = self.localIds.concat(self.serverIds);\n        let result = [];\n        imgsArr.forEach(\n            (item) => {\n                result.push(item.localId || item.serverId || item.url);\n            }\n        );\n        return result;\n    }\n\n\n    addItem(item, isLocal=0) {\n\n        let url = item.url;\n        let height = this.container.width() * 0.24;\n\n        this.container.append(`\n            <li>\n                <div class=\"item\" style=\"background-image:url(${url});height:${height}\">\n                    <img src=\"${url}\" data-localid=\"${url}\" data-islocal=\"${isLocal}\" data-sid=\"${item.id}\"/>\n                    <i class=\"${DELETE_IMG_CLASS}\"></i>\n                </div>\n            </li>\n        `);\n        this.count++;\n    }\n\n    getServerAndLocalIds() {\n        let localIds = [];\n        let serverIds = [];\n        this.container.find('img')\n            .each(\n                (index, item) => {\n\n                    let sid = $(item).data('sid');\n                    let localId = $(item).data('localid');\n\n                    let temp = {\n                        width: item.naturalWidth,\n                        height: item.naturalHeight\n                    };\n\n\n                    if (sid !== 'undefined') {\n                        temp.id = sid;\n                        temp.url = localId;\n                        serverIds.push(temp);\n                    }\n                    else {\n                        temp.localId = localId;\n                        localIds.push(temp);\n                    }\n                }\n            );\n\n        this.localIds = localIds.reverse();\n        this.serverIds = serverIds;\n    }\n\n\n    upload(callback=noop) {\n\n        let self = this;\n        let localIds = this.localIds;\n        let serverIds = this.serverIds;\n\n        if(!localIds || !localIds.length) {\n            callback(serverIds);\n            return;\n        }\n\n        let item = localIds.pop();\n\n        weixinApi.uploadImage(item.localId, (serverId) => {\n\n            serverIds.push({\n                serverId: serverId,\n                width: item.width,\n                height: item.height\n            });\n\n            self.upload(callback);\n        });\n    }\n\n}\n\n\nclass Audios extends Materials {\n    constructor(elem, options) {\n        super(elem, options);\n        this.materialType  = 'audio';\n        this.count = 0;\n        this.init();\n    }\n\n    addItem(item, isLocal=0) {\n\n        let url = item.url;\n        let seconds = item.seconds;\n\n        let urlAttribute = '';\n        let compType = '';\n        if (isLocal) {\n            urlAttribute = 'data-localid=\"' + url + '\" ';\n            compType = 'audio';\n        }\n        else {\n            urlAttribute = 'data-url=\"' + url + '\"';\n            compType = 'audioplayer';\n        }\n\n        let tempElem = $(`\n            <li>\n                <div class=\"component-${compType}\" ${urlAttribute} data-seconds=\"${seconds}\" data-sid=\"${item.id}\">\n                    <del class=\"${DELETE_IMG_CLASS}\"></del>\n                </div>\n            </li>\n        `);\n\n        if (compType === 'audio') {\n            new Audio(tempElem.children('.component-audio'));\n        }\n        else {\n            new AudioPlayer(tempElem.children('.component-audioplayer'), {\n                skin: 'weixin',\n                teimProgress: {\n\n                }\n            });\n\n        }\n        this.container.append(tempElem);\n        this.count++;\n    }\n\n    upload(callback=noop) {\n\n        let self = this;\n        let localIds = this.localIds;\n        let serverIds = this.serverIds;\n\n        if(!localIds || !localIds.length) {\n            callback(serverIds);\n            return;\n        }\n\n        let item = localIds.pop();\n\n        weixinApi.uploadVoice(item.localId, (serverId) => {\n\n            serverIds.push({\n                serverId: serverId,\n                seconds: item.seconds\n            });\n\n            self.upload(callback);\n        });\n\n    }\n\n    getServerAndLocalIds() {\n        let localIds = [];\n        let serverIds = [];\n        this.container.find('.component-audio,.component-audioplayer')\n            .each(\n                (index, item) => {\n\n                    let $item = $(item);\n                    let sid = $item.data('sid');\n\n                    let temp = {\n                        seconds: $item.data('seconds')\n                    };\n\n                    if (sid !== 'undefined') {\n                        temp.id = sid;\n                        temp.url = $item.data('url');\n                        serverIds.push(temp);\n                    }\n                    else {\n                        temp.localId = $item.data('localid');\n                        localIds.push(temp);\n                    }\n                }\n            );\n\n        this.serverIds = serverIds;\n        this.localIds = localIds.reverse();\n\n    }\n\n\n}\n\nconst DEFAULT_EDITOR_OPTIONS = {\n    imgs: {\n        limit: 20\n    },\n    voices: {\n        limit: 10\n    },\n    text: {\n        limit: 1000\n    },\n    data: {\n        content: ''\n    }\n};\n\nexport default class RichEditor extends EventBase {\n\n    /**\n     * options = {\n     *     imgs: {\n     *          limit: 8 // 图片限制\n     *     },\n     *     voices: {\n     *          limit: 5 // 语音数量限制\n     *     },\n     *     text: {\n     *          limit: 1000 //文本最大限制\n     *          rows: 5 // 行数\n     *          placeholder: '占位文本'\n     *          content: ‘初始值'\n     *     },\n     *     data: {\n     *     }\n     * }\n     */\n    constructor(elem, options={}) {\n        super(elem);\n\n        let tempOptions = {};\n        $.extend(true, tempOptions, DEFAULT_EDITOR_OPTIONS);\n        $.extend(true, tempOptions, options);\n\n        this.options = tempOptions;\n        this.init();\n    }\n\n\n    init() {\n\n        let self = this;\n        let container = self.container;\n        let options = self.options;\n\n        if (options.readonly) {\n            container.addClass('readonly');\n        }\n        container.html(\n            self.getTemplate()\n        );\n\n        self.imgButton = container.find('.icon-camera');\n        self.voiceButton = container.find('.icon-mic');\n        self.textBox = container.children('.component-richeditor-text');\n        self.textFaker = container.children('.component-richeditor-faker');\n\n\n\n        self.imagesComponent = new Images(\n            container.children('.component-richeditor-imgs'),\n            $.extend(\n                options.imgs,\n                {\n                    readonly: options.readonly,\n                    data: options.data.imgs\n                }\n            )\n        );\n        self.audiosComponent = new Audios(\n            container.children('.component-richeditor-audios'),\n            $.extend(\n                options.voices,\n                {\n                    readonly: options.readonly,\n                    data: options.data.voices\n                }\n            )\n        );\n\n\n        self.recorder = new Recorder({\n            success: (localId, seconds) => {\n                self.recordPanelOpened  = false;\n\n                if (seconds === 0) {\n                    return;\n                }\n                self.audiosComponent.addItem({\n                    url: localId,\n                    seconds: seconds\n                },1);\n            }\n        });\n\n        if (options.readonly) {\n            self.readonly(true);\n        }\n\n        self.bindEvents();\n\n    }\n    getTemplate() {\n        let options = this.options;\n        options.data.content  = options.data.content || '';\n\n        let buttonsTemplate = [];\n\n        if (options.imgs && !options.imgs.disabled) {\n            buttonsTemplate.push('<button data-opttype=\"add-img\" class=\"icon-camera\" type=\"button\">图</button>');\n        }\n\n        return `\n            <div class=\"component-richeditor-text\" contenteditable=\"${!options.readonly}\">${options.data.content}</div>\n            <ol class=\"component-richeditor-audios\">\n            </ol>\n            <ul class=\"component-richeditor-imgs\">\n            </ul>\n            <div class=\"component-richeditor-btns\">\n                ${buttonsTemplate.join('')}\n                <button data-opttype=\"add-voice\" type=\"button\" class=\"icon-mic\">音</button>\n            </div>\n        `;\n    }\n\n    bindEvents() {\n\n        let editor = this;\n        let options = this.options;\n\n        editor.container.on('click', 'button', function(e)  {\n            let $this = $(this);\n            let opttype = $this.data('opttype');\n            let leftedCount = 8;\n\n            if (opttype === 'add-img') {\n                leftedCount = options.imgs.limit - editor.imagesComponent.count;\n                if ( leftedCount > 0 ) {\n                    editor.chooseImage((leftedCount > 9) ? 9 : leftedCount );\n                }\n                else {\n                    alert('最多上传' + options.imgs.limit + '张图片');\n                }\n            }\n            else if (opttype === 'add-voice') {\n\n                leftedCount = options.voices.limit - editor.audiosComponent.count;\n                if ( leftedCount <= 0 ) {\n                    alert('最多上传' + options.voices.limit + '条语音');\n                    return;\n                }\n\n                if (editor.recordPanelOpened) {\n                    editor.closeRecordPanel();\n                }\n                else {\n                    editor.openRecordPanel();\n                }\n            }\n        });\n\n    }\n\n    chooseImage(limit=8) {\n        let editor = this;\n        weixinApi.chooseImage(\n            limit,\n            (localIds) => {\n                localIds.forEach(\n                    (item) => {\n                        editor.imagesComponent.addItem({\n                            url: item\n                        }, 1);\n                    }\n                );\n            }\n        );\n    }\n\n    openRecordPanel() {\n        this.recordPanelOpened = true;\n        this.recorder.show();\n    }\n\n    closeRecordPanel() {\n        this.recordPanelOpened = false;\n        this.recorder.hide();\n    }\n\n    upload() {\n        let editor = this;\n        loading();\n        editor.imagesComponent.getData(\n            (imgs) => {\n                editor.audiosComponent.getData(\n                    (audios) => {\n                        unloading();\n                        editor.uploaded && editor.uploaded(imgs, audios, editor.textBox.html());\n                    }\n                );\n            }\n        );\n    }\n\n    readonly(readonly=false) {\n        let editor = this;\n        let  options = editor.options;\n\n\n        editor.textBox.prop('contenteditable', !readonly);\n        editor.imagesComponent.readonly(readonly);\n        editor.audiosComponent.readonly(readonly);\n\n        if (readonly) {\n            editor.imgButton.hide();\n            editor.voiceButton.hide();\n            editor.container.addClass('readonly');\n        }\n        else {\n            editor.imgButton.show();\n            editor.voiceButton.show();\n            editor.container.removeClass('readonly');\n\n        }\n\n        options.readonly = readonly;\n    }\n\n    focus() {\n        this.textBox.focus();\n    }\n\n    getHtml() {\n        return this.textBox.html();\n    }\n\n    setHtml(content) {\n        this.textBox.html(content);\n    }\n\n}\n"]}