{"version":3,"sources":["../../src/components/RichEditor.js"],"names":["DELETE_IMG_CLASS","noop","Materials","elem","options","self","readonly","container","addClass","data","forEach","item","addItem","bindEvents","on","e","stopPropagation","$","closest","remove","count","removeClass","callback","getServerAndLocalIds","upload","Images","materialType","init","$this","currentUrl","prop","imgsArr","getAllImages","previewImage","localIds","concat","serverIds","result","push","localId","serverId","url","isLocal","height","width","append","id","find","each","index","sid","temp","naturalWidth","naturalHeight","reverse","length","pop","uploadImage","Audios","seconds","urlAttribute","compType","tempElem","children","skin","teimProgress","uploadVoice","$item","DEFAULT_EDITOR_OPTIONS","imgs","limit","voices","text","content","RichEditor","tempOptions","extend","html","getTemplate","imgButton","voiceButton","textBox","textFaker","imagesComponent","audiosComponent","recorder","success","recordPanelOpened","buttonsTemplate","disabled","join","editor","opttype","leftedCount","chooseImage","alert","closeRecordPanel","openRecordPanel","show","hide","getData","audios","uploaded","focus"],"mappings":"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","file":"RichEditor.js","sourcesContent":["\n\nimport { EventBase } from './EventBase';\nimport { weixinApi } from '../common/functions/weixinApi';\nimport { Audio } from './Audio';\nimport { AudioPlayer } from './AudioPlayer';\nimport { Recorder } from './Recorder';\n\nimport {loading, unloading} from './Toast';\n\n\nconst DELETE_IMG_CLASS = 'ion-android-remove-circle';\nconst noop = () => {};\n\nclass Materials extends EventBase {\n    constructor(elem, options) {\n        super(elem);\n        this.options = options;\n    }\n\n    init() {\n        let self = this;\n        let options = this.options;\n\n        if (options.readonly) {\n            this.container.addClass('readonly');\n        }\n\n        if (options.data) {\n            options.data.forEach(\n                (item) => {\n                    self.addItem(item);\n                }\n            );\n        }\n\n        self.bindEvents && self.bindEvents();\n\n        this.container.on('click', '.' + DELETE_IMG_CLASS, function (e) {\n            e.stopPropagation();\n            $(this).closest('li').remove();\n            self.count--;\n        });\n    }\n\n    readonly(readonly=false) {\n\n        if (readonly ) {\n            this.container.addClass('readonly');\n        }\n        else {\n            this.container.removeClass('readonly');\n        }\n        this.options.readonly = readonly;\n    }\n\n    getData(callback=noop) {\n        this.getServerAndLocalIds();\n        this.upload(callback);\n    }\n\n}\n\n\nclass Images extends Materials {\n    constructor(elem, options) {\n        super(elem, options);\n        this.materialType = 'image';\n        this.count = 0;\n        this.init();\n    }\n\n    bindEvents() {\n\n        let self = this;\n\n        this.container.on('click', 'img', function (e) {\n\n            e.stopPropagation();\n\n            let $this = $(this);\n            let currentUrl = $this.prop('src');\n\n            let imgsArr = self.getAllImages();\n\n            if (+$this.data('islocal')) {\n                currentUrl = $this.data('localid');\n            }\n            weixinApi.previewImage(currentUrl, imgsArr);\n        });\n\n\n    }\n\n    getAllImages() {\n        let self = this;\n\n        self.getServerAndLocalIds();\n\n        let imgsArr = self.localIds.concat(self.serverIds);\n        let result = [];\n        imgsArr.forEach(\n            (item) => {\n                result.push(item.localId || item.serverId || item.url);\n            }\n        );\n        return result;\n    }\n\n\n    addItem(item, isLocal=0) {\n\n        let url = item.url;\n        let height = this.container.width() * 0.24;\n\n        this.container.append(`\n            <li>\n                <div class=\"item\" style=\"background-image:url(${url});height:${height}\">\n                    <img src=\"${url}\" data-localid=\"${url}\" data-islocal=\"${isLocal}\" data-sid=\"${item.id}\"/>\n                    <i class=\"${DELETE_IMG_CLASS}\"></i>\n                </div>\n            </li>\n        `);\n        this.count++;\n    }\n\n    getServerAndLocalIds() {\n        let localIds = [];\n        let serverIds = [];\n        this.container.find('img')\n            .each(\n                (index, item) => {\n\n                    let sid = $(item).data('sid');\n                    let localId = $(item).data('localid');\n\n                    let temp = {\n                        width: item.naturalWidth,\n                        height: item.naturalHeight\n                    };\n\n\n                    if (sid !== 'undefined') {\n                        temp.id = sid;\n                        temp.url = localId;\n                        serverIds.push(temp);\n                    }\n                    else {\n                        temp.localId = localId;\n                        localIds.push(temp);\n                    }\n                }\n            );\n\n        this.localIds = localIds.reverse();\n        this.serverIds = serverIds;\n    }\n\n\n    upload(callback=noop) {\n\n        let self = this;\n        let localIds = this.localIds;\n        let serverIds = this.serverIds;\n\n        if(!localIds || !localIds.length) {\n            callback(serverIds);\n            return;\n        }\n\n        let item = localIds.pop();\n\n        weixinApi.uploadImage(item.localId, (serverId) => {\n\n            serverIds.push({\n                serverId: serverId,\n                width: item.width,\n                height: item.height\n            });\n\n            self.upload(callback);\n        });\n    }\n\n}\n\n\nclass Audios extends Materials {\n    constructor(elem, options) {\n        super(elem, options);\n        this.materialType  = 'audio';\n        this.count = 0;\n        this.init();\n    }\n\n    addItem(item, isLocal=0) {\n\n        let url = item.url;\n        let seconds = item.seconds;\n\n        let urlAttribute = '';\n        let compType = '';\n        if (isLocal) {\n            urlAttribute = 'data-localid=\"' + url + '\" ';\n            compType = 'audio';\n        }\n        else {\n            urlAttribute = 'data-url=\"' + url + '\"';\n            compType = 'audioplayer';\n        }\n\n        let tempElem = $(`\n            <li>\n                <div class=\"component-${compType}\" ${urlAttribute} data-seconds=\"${seconds}\" data-sid=\"${item.id}\">\n                    <del class=\"${DELETE_IMG_CLASS}\"></del>\n                </div>\n            </li>\n        `);\n\n        if (compType === 'audio') {\n            new Audio(tempElem.children('.component-audio'));\n        }\n        else {\n            new AudioPlayer(tempElem.children('.component-audioplayer'), {\n                skin: 'weixin',\n                teimProgress: {\n\n                }\n            });\n\n        }\n        this.container.append(tempElem);\n        this.count++;\n    }\n\n    upload(callback=noop) {\n\n        let self = this;\n        let localIds = this.localIds;\n        let serverIds = this.serverIds;\n\n        if(!localIds || !localIds.length) {\n            callback(serverIds);\n            return;\n        }\n\n        let item = localIds.pop();\n\n        weixinApi.uploadVoice(item.localId, (serverId) => {\n\n            serverIds.push({\n                serverId: serverId,\n                seconds: item.seconds\n            });\n\n            self.upload(callback);\n        });\n\n    }\n\n    getServerAndLocalIds() {\n        let localIds = [];\n        let serverIds = [];\n        this.container.find('.component-audio,.component-audioplayer')\n            .each(\n                (index, item) => {\n\n                    let $item = $(item);\n                    let sid = $item.data('sid');\n\n                    let temp = {\n                        seconds: $item.data('seconds')\n                    };\n\n                    if (sid !== 'undefined') {\n                        temp.id = sid;\n                        temp.url = $item.data('url');\n                        serverIds.push(temp);\n                    }\n                    else {\n                        temp.localId = $item.data('localid');\n                        localIds.push(temp);\n                    }\n                }\n            );\n\n        this.serverIds = serverIds;\n        this.localIds = localIds.reverse();\n\n    }\n\n\n}\n\nconst DEFAULT_EDITOR_OPTIONS = {\n    imgs: {\n        limit: 20\n    },\n    voices: {\n        limit: 10\n    },\n    text: {\n        limit: 1000\n    },\n    data: {\n        content: ''\n    }\n};\n\nexport default class RichEditor extends EventBase {\n\n    /**\n     * options = {\n     *     imgs: {\n     *          limit: 8 // 图片限制\n     *     },\n     *     voices: {\n     *          limit: 5 // 语音数量限制\n     *     },\n     *     text: {\n     *          limit: 1000 //文本最大限制\n     *          rows: 5 // 行数\n     *          placeholder: '占位文本'\n     *          content: ‘初始值'\n     *     },\n     *     data: {\n     *     }\n     * }\n     */\n    constructor(elem, options={}) {\n        super(elem);\n\n        let tempOptions = {};\n        $.extend(true, tempOptions, DEFAULT_EDITOR_OPTIONS);\n        $.extend(true, tempOptions, options);\n\n        this.options = tempOptions;\n        this.init();\n    }\n\n\n    init() {\n\n        let self = this;\n        let container = self.container;\n        let options = self.options;\n\n        if (options.readonly) {\n            container.addClass('readonly');\n        }\n        container.html(\n            self.getTemplate()\n        );\n\n        self.imgButton = container.find('.icon-camera');\n        self.voiceButton = container.find('.icon-mic');\n        self.textBox = container.children('.component-richeditor-text');\n        self.textFaker = container.children('.component-richeditor-faker');\n\n\n\n        self.imagesComponent = new Images(\n            container.children('.component-richeditor-imgs'),\n            $.extend(\n                options.imgs,\n                {\n                    readonly: options.readonly,\n                    data: options.data.imgs\n                }\n            )\n        );\n        self.audiosComponent = new Audios(\n            container.children('.component-richeditor-audios'),\n            $.extend(\n                options.voices,\n                {\n                    readonly: options.readonly,\n                    data: options.data.voices\n                }\n            )\n        );\n\n\n        self.recorder = new Recorder({\n            success: (localId, seconds) => {\n                self.recordPanelOpened  = false;\n\n                if (seconds === 0) {\n                    return;\n                }\n                self.audiosComponent.addItem({\n                    url: localId,\n                    seconds: seconds\n                },1);\n            }\n        });\n\n        if (options.readonly) {\n            self.readonly(true);\n        }\n\n        self.bindEvents();\n\n    }\n    getTemplate() {\n        let options = this.options;\n        options.data.content  = options.data.content || '';\n\n        let buttonsTemplate = [];\n\n        if (options.imgs && !options.imgs.disabled) {\n            buttonsTemplate.push('<button data-opttype=\"add-img\" class=\"icon-camera\" type=\"button\">图</button>');\n        }\n\n        return `\n            <div class=\"component-richeditor-text\" contenteditable=\"${!options.readonly}\">${options.data.content}</div>\n            <ol class=\"component-richeditor-audios\">\n            </ol>\n            <ul class=\"component-richeditor-imgs\">\n            </ul>\n            <div class=\"component-richeditor-btns\">\n                ${buttonsTemplate.join('')}\n                <button data-opttype=\"add-voice\" type=\"button\" class=\"icon-mic\">音</button>\n            </div>\n        `;\n    }\n\n    bindEvents() {\n\n        let editor = this;\n        let options = this.options;\n\n        editor.container.on('click', 'button', function(e)  {\n            let $this = $(this);\n            let opttype = $this.data('opttype');\n            let leftedCount = 8;\n\n            if (opttype === 'add-img') {\n                leftedCount = options.imgs.limit - editor.imagesComponent.count;\n                if ( leftedCount > 0 ) {\n                    editor.chooseImage((leftedCount > 9) ? 9 : leftedCount );\n                }\n                else {\n                    alert('最多上传' + options.imgs.limit + '张图片');\n                }\n            }\n            else if (opttype === 'add-voice') {\n\n                leftedCount = options.voices.limit - editor.audiosComponent.count;\n                if ( leftedCount <= 0 ) {\n                    alert('最多上传' + options.voices.limit + '条语音');\n                    return;\n                }\n\n                if (editor.recordPanelOpened) {\n                    editor.closeRecordPanel();\n                }\n                else {\n                    editor.openRecordPanel();\n                }\n            }\n        });\n\n    }\n\n    chooseImage(limit=8) {\n        let editor = this;\n        weixinApi.chooseImage(\n            limit,\n            (localIds) => {\n                localIds.forEach(\n                    (item) => {\n                        editor.imagesComponent.addItem({\n                            url: item\n                        }, 1);\n                    }\n                );\n            }\n        );\n    }\n\n    openRecordPanel() {\n        this.recordPanelOpened = true;\n        this.recorder.show();\n    }\n\n    closeRecordPanel() {\n        this.recordPanelOpened = false;\n        this.recorder.hide();\n    }\n\n    upload() {\n        let editor = this;\n        loading();\n        editor.imagesComponent.getData(\n            (imgs) => {\n                editor.audiosComponent.getData(\n                    (audios) => {\n                        unloading();\n                        editor.uploaded && editor.uploaded(imgs, audios, editor.textBox.html());\n                    }\n                );\n            }\n        );\n    }\n\n    readonly(readonly=false) {\n        let editor = this;\n        let  options = editor.options;\n\n\n        editor.textBox.prop('contenteditable', !readonly);\n        editor.imagesComponent.readonly(readonly);\n        editor.audiosComponent.readonly(readonly);\n\n        if (readonly) {\n            editor.imgButton.hide();\n            editor.voiceButton.hide();\n            editor.container.addClass('readonly');\n        }\n        else {\n            editor.imgButton.show();\n            editor.voiceButton.show();\n            editor.container.removeClass('readonly');\n\n        }\n\n        options.readonly = readonly;\n    }\n\n    focus() {\n        this.textBox.focus();\n    }\n\n    getHtml() {\n        return this.textBox.html();\n    }\n\n    setHtml(content) {\n        this.textBox.html(content);\n    }\n\n}\n"]}