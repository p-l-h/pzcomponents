{"version":3,"sources":["../../src/components/ListBase.js"],"names":[],"mappings":"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","file":"ListBase.js","sourcesContent":["\nimport {EventBase} from './EventBase';\n\nimport {getJson} from '../common/functions/request';\nimport {listenToScroll} from '../common/functions/listenToScroll';\n\nexport class ListBase extends EventBase {\n\n    /**\n     * options = {\n     *     template: '', // hogan compiled template\n     *     url: '',\n     *     processData: () = {},\n     *     defaultParams: {},\n     *     selfScroller: true,\n     *     loadMoreByHand: false,\n     *     autoLoad: true,\n     *     loadMoreTemplate: '<li>查看更多</li>'\n     * }\n     */\n    constructor(container, options) {\n        super(container);\n        this.options = options;\n        this.listData = [];\n        this.init();\n    }\n\n    init() {\n        this.fetchData(this.options.defaultParams, this.options.clearAtInitial);\n        this.initEvents();\n    }\n\n    fetchData(params, clear) {\n        let list = this;\n        let options = list.options;\n\n        let requestParams =  {};\n        $.extend(requestParams, options.defaultParams);\n        $.extend(requestParams, params);\n\n\n        if (clear) {\n            list.clear();\n        }\n\n        getJson(options.url, requestParams, (data) => {\n\n            data = data || {};\n\n            if(options.processData) {\n                options.processData(data);\n            }\n\n\n            let appendedItems = $(options.template.render(data));\n            list.container.append(\n                appendedItems\n            );\n\n            list.trigger('appended', data, appendedItems);\n\n            // let pageData = data.page || {\n            //     pageNum: 1,\n            //     pageSize: 10,\n            //     count: 0\n            // };\n\n            // if (+pageData.pageSize * +pageData.pageNum >= pageData.count) {\n            //     list.nomore(true);\n            // }\n            // else {\n            //     list.nomore(false);\n            // }\n\n        });\n    }\n\n    addListData(list) {\n\n        let listData = this.listData;\n\n        if (!list) {\n            return;\n        }\n\n        list.forEach(\n            (item) => {\n                listData.push(item);\n            }\n        );\n    }\n\n    initEvents() {\n\n        let list = this;\n        let options = list.options;\n\n        let $window = $(window);\n        let $body = $(document.body);\n\n\n        // 如果使用自动加载的话，那么久默认绑定滚到底部的事件\n        if (options.autoLoad) {\n            list.on('scrollToBottom', function () {\n\n                if (list.container.css('display') === 'none') {\n                    return;\n                }\n                list.fetchData({\n                    pageNum: ++options.defaultParams.pageNum\n                });\n            });\n            list.on('loadMore', function () {\n                list.fetchData({\n                    pageNum: ++options.defaultParams.pageNum\n                });\n            });\n        }\n\n        // 手动加载的话，绑定点击事件\n        if (list.options.loadMoreByHand) {\n            let loadMoreElem = $(list.options.loadMoreTemplate || '<li class=\"more\">查看更多</li>');\n\n            loadMoreElem.on('click', function () {\n                list.trigger('loadMore');\n            });\n            list.loadMoreElem = loadMoreElem;\n        }\n        else {\n            // 滚动加载的话，绑定滚动事件\n            listenToScroll(\n                $window,\n                (evt) => {\n\n                    if (evt.direction === 'up') {\n                        return;\n                    }\n\n                    if (list.nomoreData) {\n                        return;\n                    }\n\n                    let screenHeight = $window.height();\n                    let bodyHeight = $body.height();\n                    let scrollTop = $body.scrollTop();\n\n                    if (bodyHeight - scrollTop - 10 < screenHeight) {\n                        list.trigger('scrollToBottom');\n                    }\n                }\n            );\n        }\n\n    }\n\n\n    nomore(nomore) {\n        let list = this;\n\n        list.nomoreData = !!nomore;\n\n        if (nomore && list.options.loadMoreByHand) {\n            list.loadMoreElem.remove();\n        }\n        else if (!nomore && list.options.loadMoreByHand) {\n            list.loadMoreElem.appendTo(list.container);\n        }\n\n\n    }\n\n    getListData() {\n        return this.listData;\n    }\n\n    reload() {\n        this.fetchData(null, true);\n    }\n\n    setOptions(options) {\n\n        $.extend(this.options, options);\n        this.fetchData(this.options.defaultParams, true);\n    }\n\n    clear() {\n        this.listData = [];\n        this.container.html('');\n    }\n}\n"]}