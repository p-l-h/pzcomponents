{"version":3,"sources":["../../src/components/ListBase.js"],"names":["ListBase","container","options","listData","init","fetchData","defaultParams","clearAtInitial","initEvents","params","clear","list","requestParams","$","extend","url","data","processData","append","template","render","trigger","forEach","item","push","$window","window","$body","document","body","autoLoad","on","css","pageNum","loadMoreByHand","loadMoreElem","loadMoreTemplate","evt","direction","nomoreData","screenHeight","height","bodyHeight","scrollTop","nomore","remove","appendTo","html"],"mappings":"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","file":"ListBase.js","sourcesContent":["\nimport {EventBase} from './EventBase';\n\nimport {getJson} from '../common/functions/request';\nimport {listenToScroll} from '../common/functions/listenToScroll';\n\nexport class ListBase extends EventBase {\n\n    /**\n     * options = {\n     *     template: '', // hogan compiled template\n     *     url: '',\n     *     processData: () = {},\n     *     defaultParams: {},\n     *     selfScroller: true,\n     *     loadMoreByHand: false,\n     *     autoLoad: true,\n     *     loadMoreTemplate: '<li>查看更多</li>'\n     * }\n     */\n    constructor(container, options) {\n        super(container);\n        this.options = options;\n        this.listData = [];\n        this.init();\n    }\n\n    init() {\n        this.fetchData(this.options.defaultParams, this.options.clearAtInitial);\n        this.initEvents();\n    }\n\n    fetchData(params, clear) {\n        let list = this;\n        let options = list.options;\n\n        let requestParams =  {};\n        $.extend(requestParams, options.defaultParams);\n        $.extend(requestParams, params);\n\n\n        if (clear) {\n            list.clear();\n        }\n\n        getJson(options.url, requestParams, (data) => {\n\n            data = data || {};\n\n            if(options.processData) {\n                data = options.processData(data);\n            }\n\n\n            list.container.append(\n                options.template.render(data)\n            );\n\n            list.trigger('appended', data);\n\n            // let pageData = data.page || {\n            //     pageNum: 1,\n            //     pageSize: 10,\n            //     count: 0\n            // };\n\n            // if (+pageData.pageSize * +pageData.pageNum >= pageData.count) {\n            //     list.nomore(true);\n            // }\n            // else {\n            //     list.nomore(false);\n            // }\n\n        });\n    }\n\n    addListData(list) {\n\n        let listData = this.listData;\n\n        if (!list) {\n            return;\n        }\n\n        list.forEach(\n            (item) => {\n                listData.push(item);\n            }\n        );\n    }\n\n    initEvents() {\n\n        let list = this;\n        let options = list.options;\n\n        let $window = $(window);\n        let $body = $(document.body);\n\n\n        // 如果使用自动加载的话，那么久默认绑定滚到底部的事件\n        if (options.autoLoad) {\n            list.on('scrollToBottom', function () {\n                if (list.container.css('display') === 'none') {\n                    return;\n                }\n                list.fetchData({\n                    pageNum: ++options.defaultParams.pageNum\n                });\n            });\n            list.on('loadMore', function () {\n                list.fetchData({\n                    pageNum: ++options.defaultParams.pageNum\n                });\n            });\n        }\n\n        // 手动加载的话，绑定点击事件\n        if (list.options.loadMoreByHand) {\n            let loadMoreElem = $(list.options.loadMoreTemplate || '<li class=\"more\">查看更多</li>');\n\n            loadMoreElem.on('click', function () {\n                list.trigger('loadMore');\n            });\n            list.loadMoreElem = loadMoreElem;\n        }\n        else {\n            // 滚动加载的话，绑定滚动事件\n            listenToScroll(\n                $window,\n                (evt) => {\n\n                    if (evt.direction === 'up') {\n                        return;\n                    }\n\n                    if (list.nomoreData) {\n                        return;\n                    }\n\n                    let screenHeight = $window.height();\n                    let bodyHeight = $body.height();\n                    let scrollTop = $body.scrollTop();\n\n                    if (bodyHeight - scrollTop - 10 < screenHeight) {\n                        list.trigger('scrollToBottom');\n                    }\n                }\n            );\n        }\n\n    }\n\n\n    nomore(nomore) {\n        let list = this;\n\n        list.nomoreData = !!nomore;\n\n        if (nomore && list.options.loadMoreByHand) {\n            list.loadMoreElem.remove();\n        }\n        else if (!nomore && list.options.loadMoreByHand) {\n            list.loadMoreElem.appendTo(list.container);\n        }\n\n\n    }\n\n    getListData() {\n        return this.listData;\n    }\n\n    reload() {\n        this.fetchData(null, true);\n    }\n\n    setOptions(options) {\n\n        $.extend(this.options, options);\n        this.fetchData(this.options.defaultParams, true);\n    }\n\n    clear() {\n        this.listData = [];\n        this.container.html('');\n    }\n}\n"]}