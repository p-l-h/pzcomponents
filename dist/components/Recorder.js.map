{"version":3,"sources":["../../src/components/Recorder.js"],"names":[],"mappings":";;;;;;;;;;;;;;AACA;;AAEA;;;;IAEqB,Q;AACjB,sBAAY,OAAZ,EAAqB;AAAA;;AACjB,aAAK,OAAL,GAAe,OAAf;AACA,aAAK,IAAL;AACH;;;;+BAEM;;AAEH,gBAAI,OAAO,IAAX;;AAEA,iBAAK,IAAL,GAAY,EAAE,KAAK,WAAL,EAAF,CAAZ;AACA,iBAAK,KAAL,GAAa,iBAAU;AACnB,uBAAO,KAAK;AADO,aAAV,CAAb;AAGA,iBAAK,SAAL,GAAiB,KAAK,IAAL,CAAU,IAAV,CAAe,IAAf,CAAjB;;AAEA,iBAAK,UAAL;AACH;;;sCAEa;AACV;AAOH;;;qCAEY;AACT,gBAAI,OAAO,IAAX;AACA,gBAAI,OAAO,KAAK,IAAhB;;AAEA,iBAAK,EAAL,CAAQ,OAAR,EAAiB,QAAjB,EAA2B,UAAC,CAAD,EAAO;;AAE9B,oBAAI,KAAK,SAAL,IAAkB,KAAK,WAAL,GAAmB,CAAzC,EAA4C;AACxC;AACH;;AAED,oBAAI,KAAK,SAAT,EAAoB;AAChB,yBAAK,UAAL;AACH,iBAFD,MAGK;AACD,yBAAK,WAAL;AACH;AACJ,aAZD;AAaH;;;sCAEa;AACV,gBAAI,OAAO,IAAX;AACA,iBAAK,SAAL,GAAiB,IAAjB;AACA,iCAAU,WAAV;AACA,iBAAK,IAAL,CAAU,QAAV,CAAmB,QAAnB;AACA,iBAAK,SAAL,CAAe,IAAf,CAAoB,CAApB;;AAEA,iBAAK,gBAAL;;AAEA,iCAAU,gBAAV,CACI,UAAU,OAAV,EAAmB;AACf,qBAAK,aAAL,CAAmB,OAAnB,EAA4B,EAA5B;AACA,qBAAK,WAAL,GAAmB,CAAnB;AACH,aAJL;AAMH;;;qCAEY;AACT,gBAAI,OAAO,IAAX;;AAEA,iCAAU,UAAV,CACI,UAAS,OAAT,EAAkB;AACd,qBAAK,aAAL,CAAmB,OAAnB,EAA4B,KAAK,WAAjC;AACH,aAHL;AAKH;;;2CAEkB;AACf,gBAAI,OAAO,IAAX;AACA,iBAAK,WAAL,GAAmB,CAAnB;AACA,iBAAK,cAAL,GAAsB,OAAO,WAAP,CAClB,YAAY;AACR,qBAAK,WAAL;AACA,qBAAK,SAAL,CAAe,IAAf,CAAoB,KAAK,WAAzB;AACH,aAJiB,EAKlB,IALkB,CAAtB;AAOH;;;sCAEa,O,EAAS,O,EAAS;AAC5B,gBAAI,OAAO,IAAX;AACA,gBAAI,UAAU,KAAK,OAAnB;AACA,mBAAO,aAAP,CAAqB,KAAK,cAA1B;AACA,iBAAK,SAAL,GAAiB,KAAjB;AACA,iBAAK,IAAL;;AAGA,gBAAI,QAAQ,OAAZ,EAAqB;AACjB,wBAAQ,OAAR,CAAgB,OAAhB,EAAyB,OAAzB;AACH;AACJ;;;+BAEM;AACH,iBAAK,IAAL,CAAU,WAAV,CAAsB,QAAtB;AACA,iBAAK,KAAL,CAAW,IAAX;AACH;;;+BAEM;AACH,iBAAK,KAAL,CAAW,IAAX;AACH;;;;;kBA3GgB,Q","file":"Recorder.js","sourcesContent":["\nimport {Panel} from './Panel';\n\nimport { weixinApi } from '../common/functions/weixinApi';\n\nexport default class Recorder {\n    constructor(options) {\n        this.options = options;\n        this.init();\n    }\n\n    init() {\n\n        let self = this;\n\n        self.main = $(self.getTemplate());\n        self.panel = new Panel({\n            inner: self.main\n        });\n        self.counterEm = self.main.find('em');\n\n        self.bindEvents();\n    }\n\n    getTemplate() {\n        return `\n            <div class=\"component-recorder\">\n                <div class=\"component-recorder-text\">点击录音</div>\n                <div class=\"component-recorder-text active\"><em>0</em>s/60s</div>\n                <button type=\"button\"></button>\n            </div>\n        `;\n    }\n\n    bindEvents() {\n        let self = this;\n        let main = self.main;\n\n        main.on('click', 'button', (e) => {\n\n            if (self.recording && self.timeCounter < 1) {\n                return;\n            }\n\n            if (self.recording) {\n                self.stopRecord();\n            }\n            else {\n                self.startRecord();\n            }\n        });\n    }\n\n    startRecord() {\n        let self = this;\n        self.recording = true;\n        weixinApi.startRecord();\n        self.main.addClass('active');\n        self.counterEm.html(0);\n\n        self.startRecordTimer();\n\n        weixinApi.onVoiceRecordEnd(\n            function (localId) {\n                self.voiceRecorded(localId, 60);\n                self.timeCounter = 0;\n            }\n        );\n    }\n\n    stopRecord() {\n        let self = this;\n\n        weixinApi.stopRecord(\n            function(localId) {\n                self.voiceRecorded(localId, self.timeCounter);\n            }\n        );\n    }\n\n    startRecordTimer() {\n        let self = this;\n        self.timeCounter = 0;\n        self.recordInterval = window.setInterval(\n            function () {\n                self.timeCounter++;\n                self.counterEm.html(self.timeCounter);\n            },\n            1000\n        );\n    }\n\n    voiceRecorded(localId, seconds) {\n        let self = this;\n        let options = self.options;\n        window.clearInterval(self.recordInterval);\n        self.recording = false;\n        self.hide();\n\n\n        if (options.success) {\n            options.success(localId, seconds);\n        }\n    }\n\n    show() {\n        this.main.removeClass('active');\n        this.panel.show();\n    }\n\n    hide() {\n        this.panel.hide();\n    }\n\n}\n"]}