{"version":3,"sources":["../../src/components/Audio.js"],"names":["Audio","container","url","data","localId","seconds","init","html","getTemplate","thisWidth","Math","sqrt","css","bindEvents","that","onVoicePlayEnd","weixinToggle","on","toggle","gif","children","playing","stopVoice","removeClass","playVoice","addClass","$this","$audio","audio","progress","addEventListener","percent","currentTime","duration","paused","play","pause"],"mappings":"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","file":"Audio.js","sourcesContent":["\n\n\nimport {weixinApi} from '../common/functions/weixinApi';\n\nexport class Audio {\n    constructor(container) {\n\n        this.container = container;\n        this.url = container.data('url');\n        this.localId = container.data('localid');\n        this.seconds = container.data('seconds');\n        this.init();\n    }\n    init() {\n\n        let container = this.container;\n\n        if (+container.data('inited')) {\n            return;\n        }\n\n        container.html(\n            this.getTemplate() + container.html()\n        );\n\n        let thisWidth = 0.15 + Math.sqrt(this.seconds/60) * 0.85;\n        thisWidth *= 100;\n        container.css('width', thisWidth + '%');\n        this.bindEvents();\n\n        container.data('inited', 1);\n    }\n    getTemplate() {\n        if (!this.localId) {\n            return  `\n                <i></i>\n                <em>${this.seconds}''</em>\n                <div class=\"component-audio-progress\"></div>\n                <audio preload=\"none\" controls src=\"${this.url}\"></audio>\n            `;\n        }\n        else {\n            return  `\n                <i></i>\n                <em>${this.seconds}''</em>\n                <div class=\"component-audio-progress\"></div>\n            `;\n        }\n\n    }\n    bindEvents() {\n        let that = this;\n\n        weixinApi.onVoicePlayEnd(function (localId) {\n            if (localId === that.localId) {\n                that.weixinToggle();\n            }\n        });\n        this.container.on('click', () => {\n\n            if (that.localId) {\n                that.weixinToggle();\n            }\n            else {\n                that.toggle();\n            }\n        });\n    }\n\n    weixinToggle() {\n        let that = this;\n        let container = this.container;\n        let gif = container.children('i');\n\n        if (that.playing) {\n            weixinApi.stopVoice(that.localId);\n            gif.removeClass('playing');\n        }\n        else {\n            weixinApi.playVoice(that.localId);\n            gif.addClass('playing');\n        }\n\n\n        that.playing = !that.playing;\n\n    }\n\n    toggle() {\n        let $this = this.container;\n        let $audio = $this.children('audio');\n        let audio = $audio[0];\n        let gif = $this.children('i');\n        let progress = $this.children('.component-audio-progress');\n\n        if (!$audio.data('binded')) {\n            audio.addEventListener('pause', function () {\n                gif.removeClass('playing');\n            });\n\n            audio.addEventListener('timeupdate', function () {\n\n                let percent = audio.currentTime / audio.duration  * 100 ;\n\n                if (percent > 100) {\n                    percent = 100;\n                }\n                progress.css(\n                    'width',\n                    percent + '%'\n                );\n            });\n\n\n            $audio.data('binded', 1);\n        }\n\n        if (audio.paused) {\n            audio.play();\n        }\n        else {\n            audio.pause();\n        }\n\n        gif.addClass('playing');\n    }\n\n\n    distroy() {\n\n    }\n}\n"]}