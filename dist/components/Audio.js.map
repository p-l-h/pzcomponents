{"version":3,"sources":["../../src/components/Audio.js"],"names":[],"mappings":";;;;;;;;;;;;;;;AAGA;;;;IAEa,K,WAAA,K;AACT,mBAAY,SAAZ,EAAuB;AAAA;;;AAEnB,aAAK,SAAL,GAAiB,SAAjB;AACA,aAAK,GAAL,GAAW,UAAU,IAAV,CAAe,KAAf,CAAX;AACA,aAAK,OAAL,GAAe,UAAU,IAAV,CAAe,SAAf,CAAf;AACA,aAAK,OAAL,GAAe,UAAU,IAAV,CAAe,SAAf,CAAf;AACA,aAAK,IAAL;AACH;;;;+BACM;;AAEH,gBAAI,YAAY,KAAK,SAArB;;AAEA,gBAAI,CAAC,UAAU,IAAV,CAAe,QAAf,CAAL,EAA+B;AAC3B;AACH;;AAED,sBAAU,IAAV,CACI,KAAK,WAAL,KAAqB,UAAU,IAAV,EADzB;;AAIA,gBAAI,YAAY,OAAO,KAAK,IAAL,CAAU,KAAK,OAAL,GAAa,EAAvB,IAA6B,IAApD;AACA,yBAAa,GAAb;AACA,sBAAU,GAAV,CAAc,OAAd,EAAuB,YAAY,GAAnC;AACA,iBAAK,UAAL;;AAEA,sBAAU,IAAV,CAAe,QAAf,EAAyB,CAAzB;AACH;;;sCACa;AACV,gBAAI,CAAC,KAAK,OAAV,EAAmB;AACf,2EAEU,KAAK,OAFf,qIAI0C,KAAK,GAJ/C;AAMH,aAPD,MAQK;AACD,2EAEU,KAAK,OAFf;AAKH;AAEJ;;;qCACY;AACT,gBAAI,OAAO,IAAX;;AAEA,iCAAU,cAAV,CAAyB,UAAU,OAAV,EAAmB;AACxC,oBAAI,YAAY,KAAK,OAArB,EAA8B;AAC1B,yBAAK,YAAL;AACH;AACJ,aAJD;AAKA,iBAAK,SAAL,CAAe,EAAf,CAAkB,OAAlB,EAA2B,YAAM;;AAE7B,oBAAI,KAAK,OAAT,EAAkB;AACd,yBAAK,YAAL;AACH,iBAFD,MAGK;AACD,yBAAK,MAAL;AACH;AACJ,aARD;AASH;;;uCAEc;AACX,gBAAI,OAAO,IAAX;AACA,gBAAI,YAAY,KAAK,SAArB;AACA,gBAAI,MAAM,UAAU,QAAV,CAAmB,GAAnB,CAAV;;AAEA,gBAAI,KAAK,OAAT,EAAkB;AACd,qCAAU,SAAV,CAAoB,KAAK,OAAzB;AACA,oBAAI,WAAJ,CAAgB,SAAhB;AACH,aAHD,MAIK;AACD,qCAAU,SAAV,CAAoB,KAAK,OAAzB;AACA,oBAAI,QAAJ,CAAa,SAAb;AACH;;AAGD,iBAAK,OAAL,GAAe,CAAC,KAAK,OAArB;AAEH;;;iCAEQ;AACL,gBAAI,QAAQ,KAAK,SAAjB;AACA,gBAAI,SAAS,MAAM,QAAN,CAAe,OAAf,CAAb;AACA,gBAAI,QAAQ,OAAO,CAAP,CAAZ;AACA,gBAAI,MAAM,MAAM,QAAN,CAAe,GAAf,CAAV;AACA,gBAAI,WAAW,MAAM,QAAN,CAAe,2BAAf,CAAf;;AAEA,gBAAI,CAAC,OAAO,IAAP,CAAY,QAAZ,CAAL,EAA4B;AACxB,sBAAM,gBAAN,CAAuB,OAAvB,EAAgC,YAAY;AACxC,wBAAI,WAAJ,CAAgB,SAAhB;AACH,iBAFD;;AAIA,sBAAM,gBAAN,CAAuB,YAAvB,EAAqC,YAAY;;AAE7C,wBAAI,UAAU,MAAM,WAAN,GAAoB,MAAM,QAA1B,GAAsC,GAApD;;AAEA,wBAAI,UAAU,GAAd,EAAmB;AACf,kCAAU,GAAV;AACH;AACD,6BAAS,GAAT,CACI,OADJ,EAEI,UAAU,GAFd;AAIH,iBAXD;;AAcA,uBAAO,IAAP,CAAY,QAAZ,EAAsB,CAAtB;AACH;;AAED,gBAAI,MAAM,MAAV,EAAkB;AACd,sBAAM,IAAN;AACH,aAFD,MAGK;AACD,sBAAM,KAAN;AACH;;AAED,gBAAI,QAAJ,CAAa,SAAb;AACH;;;kCAGS,CAET","file":"Audio.js","sourcesContent":["\n\n\nimport {weixinApi} from '../common/functions/weixinApi';\n\nexport class Audio {\n    constructor(container) {\n\n        this.container = container;\n        this.url = container.data('url');\n        this.localId = container.data('localid');\n        this.seconds = container.data('seconds');\n        this.init();\n    }\n    init() {\n\n        let container = this.container;\n\n        if (+container.data('inited')) {\n            return;\n        }\n\n        container.html(\n            this.getTemplate() + container.html()\n        );\n\n        let thisWidth = 0.15 + Math.sqrt(this.seconds/60) * 0.85;\n        thisWidth *= 100;\n        container.css('width', thisWidth + '%');\n        this.bindEvents();\n\n        container.data('inited', 1);\n    }\n    getTemplate() {\n        if (!this.localId) {\n            return  `\n                <i></i>\n                <em>${this.seconds}''</em>\n                <div class=\"component-audio-progress\"></div>\n                <audio preload=\"none\" controls src=\"${this.url}\"></audio>\n            `;\n        }\n        else {\n            return  `\n                <i></i>\n                <em>${this.seconds}''</em>\n                <div class=\"component-audio-progress\"></div>\n            `;\n        }\n\n    }\n    bindEvents() {\n        let that = this;\n\n        weixinApi.onVoicePlayEnd(function (localId) {\n            if (localId === that.localId) {\n                that.weixinToggle();\n            }\n        });\n        this.container.on('click', () => {\n\n            if (that.localId) {\n                that.weixinToggle();\n            }\n            else {\n                that.toggle();\n            }\n        });\n    }\n\n    weixinToggle() {\n        let that = this;\n        let container = this.container;\n        let gif = container.children('i');\n\n        if (that.playing) {\n            weixinApi.stopVoice(that.localId);\n            gif.removeClass('playing');\n        }\n        else {\n            weixinApi.playVoice(that.localId);\n            gif.addClass('playing');\n        }\n\n\n        that.playing = !that.playing;\n\n    }\n\n    toggle() {\n        let $this = this.container;\n        let $audio = $this.children('audio');\n        let audio = $audio[0];\n        let gif = $this.children('i');\n        let progress = $this.children('.component-audio-progress');\n\n        if (!$audio.data('binded')) {\n            audio.addEventListener('pause', function () {\n                gif.removeClass('playing');\n            });\n\n            audio.addEventListener('timeupdate', function () {\n\n                let percent = audio.currentTime / audio.duration  * 100 ;\n\n                if (percent > 100) {\n                    percent = 100;\n                }\n                progress.css(\n                    'width',\n                    percent + '%'\n                );\n            });\n\n\n            $audio.data('binded', 1);\n        }\n\n        if (audio.paused) {\n            audio.play();\n        }\n        else {\n            audio.pause();\n        }\n\n        gif.addClass('playing');\n    }\n\n\n    distroy() {\n\n    }\n}\n"]}