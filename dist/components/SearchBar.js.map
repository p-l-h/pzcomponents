{"version":3,"sources":["../../src/components/SearchBar.js"],"names":["SearchBar","container","options","init","html","getTemplate","searchInput","find","searchForm","initEvents","action","method","field","placeholder","self","on","e","preventDefault","postData","val","trim","getParams","data","searched","call","focus","$","document","form","contains","target","blur","selfTrigger","active","addClass","removeClass"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;AACA;;;;IAEaA,S,WAAAA,S;;;AAYT,uBAAYC,SAAZ,EAAuBC,OAAvB,EAAgC;AAAA;;AAAA,gJACtBD,SADsB;;AAG5B,cAAKC,OAAL,GAAeA,OAAf;AACA,cAAKC,IAAL;AAJ4B;AAK/B;;;;+BACM;AACH,iBAAKF,SAAL,CAAeG,IAAf,CACI,KAAKC,WAAL,EADJ;;AAIA,iBAAKC,WAAL,GAAmB,KAAKL,SAAL,CAAeM,IAAf,CAAoB,sBAApB,CAAnB;AACA,iBAAKC,UAAL,GAAkB,KAAKP,SAAL,CAAeM,IAAf,CAAoB,MAApB,CAAlB;;AAGA,iBAAKE,UAAL;AACH;;;sCAEa;;AAEV,gBAAIP,UAAU,KAAKA,OAAnB;AACA,qFACqDA,QAAQQ,MAD7D,kBACgFR,QAAQS,MADxF,oHAGyCT,QAAQU,KAHjD,wBAGwEV,QAAQW,WAAR,IAAqB,EAH7F;AAQH;;;qCAGY;;AAET,gBAAIC,OAAO,IAAX;AACA,gBAAIZ,UAAUY,KAAKZ,OAAnB;;AAEAY,iBAAKN,UAAL,CACKO,EADL,CACQ,QADR,EACkB,UAAUC,CAAV,EAAa;;AAEvBA,kBAAEC,cAAF;;AAEA,oBAAIC,WAAW,EAAf;AACAA,yBAAShB,QAAQU,KAAjB,IAA0BE,KAAKR,WAAL,CAAiBa,GAAjB,GAAuBC,IAAvB,EAA1B;;AAEA,oBAAIlB,QAAQmB,SAAZ,EAAuB;AACnBH,+BAAWhB,QAAQmB,SAAR,CAAkBH,QAAlB,CAAX;AACH;;AAGD,uCACIhB,QAAQQ,MADZ,EAEIQ,QAFJ,EAGI,UAACI,IAAD,EAAU;AACNpB,4BAAQqB,QAAR,CAAiBC,IAAjB,CAAsBV,IAAtB,EAA4BQ,IAA5B;AACH,iBALL;AAQH,aArBL,EAsBKP,EAtBL,CAsBQ,OAtBR,EAsBiB,UAAUC,CAAV,EAAa;AACtBF,qBAAKW,KAAL;AACH,aAxBL;;AA0BAC,cAAEC,QAAF,EAAYZ,EAAZ,CAAe,OAAf,EAAwB,UAAUC,CAAV,EAAa;AACjC,oBAAIY,OAAOd,KAAKN,UAAL,CAAgB,CAAhB,CAAX;;AAEA,oBAAI,CAACkB,EAAEG,QAAF,CAAWD,IAAX,EAAiBZ,EAAEc,MAAnB,CAAL,EAAiC;AAC7BhB,yBAAKiB,IAAL;AACH;AACJ,aAND;AAOH;;;8BAOKC,W,EAAa;AACf,iBAAKC,MAAL,GAAc,IAAd;AACA,iBAAKhC,SAAL,CAAeiC,QAAf,CAAwB,QAAxB;AACA,aAACF,WAAD,IAAgB,KAAK1B,WAAL,CAAiBmB,KAAjB,EAAhB;AACH;;;6BAOIO,W,EAAa;AACd,iBAAKC,MAAL,GAAc,KAAd;AACA,iBAAKhC,SAAL,CAAekC,WAAf,CAA2B,QAA3B;AACA,aAACH,WAAD,IAAgB,KAAK1B,WAAL,CAAiByB,IAAjB,EAAhB;AAEH","file":"SearchBar.js","sourcesContent":["\n\nimport {EventBase} from './EventBase';\nimport {postJson} from '../common/functions/request';\n\nexport class SearchBar extends EventBase {\n\n    /**\n     * Creates an instance of SearchBar.\n     *\n     * @param {ZeptoElem} container 容器\n     * @param {Object} options 配置项\n     * @property {string} options.method GET OR POST\n     * @property {string} options.action 要请求的url\n     * @property {Function} options.getParams 获取查询参数\n     * @property {Function} options.searched 搜索结束之后\n     */\n    constructor(container, options) {\n        super(container);\n\n        this.options = options;\n        this.init();\n    }\n    init() {\n        this.container.html(\n            this.getTemplate()\n        );\n\n        this.searchInput = this.container.find('input[type=\"search\"]');\n        this.searchForm = this.container.find('form');\n\n\n        this.initEvents();\n    }\n\n    getTemplate() {\n\n        let options = this.options;\n        return `\n            <form class=\"component-searchbar-form\" action=\"${options.action}\" method=\"${options.method}\">\n                <div class=\"component-searchbar-input\">\n                    <input type=\"search\" name=\"${options.field}\" placeholder=\"${options.placeholder||''}\"/>\n                </div>\n                <button type=\"submit\" class=\"ion-ios-search\"></button>\n            </form>\n        `;\n    }\n\n\n    initEvents() {\n\n        let self = this;\n        let options = self.options;\n\n        self.searchForm\n            .on('submit', function (e) {\n\n                e.preventDefault();\n\n                let postData = {};\n                postData[options.field] = self.searchInput.val().trim();\n\n                if (options.getParams) {\n                    postData = options.getParams(postData);\n                }\n\n\n                postJson(\n                    options.action,\n                    postData,\n                    (data) => {\n                        options.searched.call(self, data);\n                    }\n                );\n\n            })\n            .on('click', function (e) {\n                self.focus();\n            });\n\n        $(document).on('click', function (e) {\n            let form = self.searchForm[0];\n\n            if (!$.contains(form, e.target)) {\n                self.blur();\n            }\n        });\n    }\n\n    /**\n     * 激活searchbar\n     *\n     * @param {Boolean} selfTrigger 是否是由输入框触发的\n     */\n    focus(selfTrigger) {\n        this.active = true;\n        this.container.addClass('active');\n        !selfTrigger && this.searchInput.focus();\n    }\n\n    /**\n     * 移除searchbar 的激活状态\n     *\n     * @param {Boolean} selfTrigger 是否是由输入框触发的\n     */\n    blur(selfTrigger) {\n        this.active = false;\n        this.container.removeClass('active');\n        !selfTrigger && this.searchInput.blur();\n\n    }\n}\n"]}